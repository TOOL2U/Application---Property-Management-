<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Out Button Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #1a1a2e;
            color: #fff;
        }
        
        .container {
            background: #16213e;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 20px;
        }
        
        h1 {
            color: #8b5cf6;
            margin-bottom: 20px;
        }
        
        .test-section {
            background: #0f1419;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border: 1px solid #333;
        }
        
        .button {
            background: #8b5cf6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
            transition: background 0.3s;
        }
        
        .button:hover {
            background: #7c3aed;
        }
        
        .button.danger {
            background: #ef4444;
        }
        
        .button.danger:hover {
            background: #dc2626;
        }
        
        .info {
            background: #1e40af;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        
        .success {
            background: #059669;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        
        .error {
            background: #dc2626;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        
        .code {
            background: #000;
            color: #0f0;
            padding: 10px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            margin: 10px 0;
        }
        
        .status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .online {
            background: #059669;
            color: white;
        }
        
        .offline {
            background: #dc2626;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üî¥ Sign Out Button Test - Mobile App</h1>
        
        <div class="info">
            <strong>üì± Mobile App URL:</strong> <a href="http://localhost:8082" target="_blank" style="color: #60a5fa;">http://localhost:8082</a>
        </div>
        
        <div class="test-section">
            <h2>üß™ Test Instructions</h2>
            <ol>
                <li><strong>Login to Mobile App:</strong> Use <code>staff@siamoon.com</code> / <code>password123</code></li>
                <li><strong>Find Sign Out Button:</strong> Look for the red logout icon in the dashboard header</li>
                <li><strong>Click Sign Out:</strong> Should show confirmation dialog</li>
                <li><strong>Confirm Sign Out:</strong> Should redirect to login page</li>
            </ol>
        </div>
        
        <div class="test-section">
            <h2>üéØ Send Test Job</h2>
            <p>Send a test job to staff@siamoon.com to test the sign out button in the staff dashboard:</p>
            <button class="button" onclick="sendTestJob()">üì§ Send Test Job</button>
            <div id="jobResult"></div>
        </div>
        
        <div class="test-section">
            <h2>üîç Debug Tools</h2>
            <button class="button" onclick="checkMobileAppStatus()">üì° Check Mobile App Status</button>
            <button class="button" onclick="openMobileApp()">üì± Open Mobile App</button>
            <button class="button danger" onclick="clearLogs()">üóëÔ∏è Clear Logs</button>
            <div id="debugResult"></div>
        </div>
        
        <div class="test-section">
            <h2>üìä Expected Sign Out Behavior</h2>
            <div class="code">
1. Click red logout button in header
2. Confirmation dialog appears
3. Click "Sign Out" in dialog
4. Loading state shows briefly
5. Auth context clears user data
6. Tab layout detects no auth
7. Automatically redirects to login
8. Login page appears
            </div>
        </div>
        
        <div class="test-section">
            <h2>üö® Common Issues & Solutions</h2>
            
            <h3>Issue: Button doesn't respond</h3>
            <ul>
                <li>Check console for errors</li>
                <li>Ensure TouchableOpacity is not disabled</li>
                <li>Verify handleSignOut function is called</li>
            </ul>
            
            <h3>Issue: No redirect after sign out</h3>
            <ul>
                <li>Check AuthContext signOut function</li>
                <li>Verify tab layout useEffect dependency</li>
                <li>Check router.replace() call</li>
            </ul>
            
            <h3>Issue: Auth state not clearing</h3>
            <ul>
                <li>Check authService.signOut() implementation</li>
                <li>Verify storage clearing</li>
                <li>Check setState calls in AuthContext</li>
            </ul>
        </div>
        
        <div class="test-section">
            <h2>üî¨ Live Console Logs</h2>
            <div id="consoleLogs" class="code" style="height: 200px; overflow-y: auto;"></div>
        </div>
    </div>

    <script>
        // Console log capture
        const originalLog = console.log;
        const originalError = console.error;
        const logContainer = document.getElementById('consoleLogs');
        
        function addLog(type, message) {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${type}: ${message}`;
            logContainer.textContent += logEntry + '\n';
            logContainer.scrollTop = logContainer.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addLog('LOG', args.join(' '));
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addLog('ERROR', args.join(' '));
        };
        
        async function sendTestJob() {
            const resultDiv = document.getElementById('jobResult');
            resultDiv.innerHTML = '<div class="info">üîÑ Sending test job...</div>';
            
            try {
                const response = await fetch('/api/test-job', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        staffEmail: 'staff@siamoon.com',
                        priority: 'high',
                        type: 'cleaning'
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    resultDiv.innerHTML = `
                        <div class="success">
                            ‚úÖ Test job sent successfully!<br>
                            Job ID: ${result.jobId}<br>
                            Now check the mobile app dashboard for the sign out button.
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `<div class="error">‚ùå Failed to send test job: ${result.error}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">‚ùå Error: ${error.message}</div>`;
            }
        }
        
        async function checkMobileAppStatus() {
            const resultDiv = document.getElementById('debugResult');
            resultDiv.innerHTML = '<div class="info">üîç Checking mobile app status...</div>';
            
            try {
                const response = await fetch('http://localhost:8082/');
                if (response.ok) {
                    resultDiv.innerHTML = '<div class="success">‚úÖ Mobile app is running and accessible</div>';
                } else {
                    resultDiv.innerHTML = '<div class="error">‚ùå Mobile app responded with error</div>';
                }
            } catch (error) {
                resultDiv.innerHTML = '<div class="error">‚ùå Mobile app is not running or not accessible</div>';
            }
        }
        
        function openMobileApp() {
            window.open('http://localhost:8082', '_blank');
        }
        
        function clearLogs() {
            document.getElementById('consoleLogs').textContent = '';
        }
        
        // Auto-refresh status
        setInterval(checkMobileAppStatus, 30000);
        
        // Initial status check
        checkMobileAppStatus();
    </script>
</body>
</html>
